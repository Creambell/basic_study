-- 테이블 삭제 (조건부)
BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE "USER" CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/
BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE "BOARD" CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/
BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE "IMAGE" CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/
BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE "REPLY" CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/
BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE "CATEGORY" CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/

-- 시퀀스 삭제 (조건부)
BEGIN
   EXECUTE IMMEDIATE 'DROP SEQUENCE USER_SEQ';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/
BEGIN
   EXECUTE IMMEDIATE 'DROP SEQUENCE BOARD_SEQ';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/
BEGIN
   EXECUTE IMMEDIATE 'DROP SEQUENCE IMAGE_SEQ';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/
BEGIN
   EXECUTE IMMEDIATE 'DROP SEQUENCE REPLY_SEQ';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/
BEGIN
   EXECUTE IMMEDIATE 'DROP SEQUENCE CATEGORY_SEQ';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/

-- USER 테이블 생성
CREATE TABLE "USER" (
    "USER_NO" NUMBER NOT NULL,
    "USER_NAME" VARCHAR2(20) NOT NULL,
    "USER_ID" VARCHAR2(20) NOT NULL,
    "USER_PWD" VARCHAR2(50) NOT NULL,
    "USER_EMAIL" VARCHAR2(200),
    "USER_PHONE" VARCHAR2(11),
    "USER_STATUS" CHAR(1) DEFAULT 'N' NOT NULL,
    "USER_GRADE" VARCHAR2(10) DEFAULT 'USER' NOT NULL,
    "USER_JOIN_DATE" DATE DEFAULT SYSDATE NOT NULL,
    CONSTRAINT "PK_USER" PRIMARY KEY ("USER_NO")
);

-- BOARD 테이블 생성
CREATE TABLE "BOARD" (
    "BOARD_NO" NUMBER NOT NULL,
    "CATE_NO" NUMBER NOT NULL,
    "BOARD_WRITER_NO" NUMBER NOT NULL,
    "BOARD_WRITER_NAME" VARCHAR2(20) NOT NULL,
    "BOARD_TITLE" VARCHAR2(100) NOT NULL,
    "BOARD_CONTENT" CLOB NOT NULL,
    "BOARD_COUNT" NUMBER DEFAULT 0 NOT NULL,
    "BOARD_STATUS" CHAR(1) DEFAULT 'N' NOT NULL,
    "CREATE_DATE" DATE DEFAULT SYSDATE NOT NULL,
    "UPDATE_DATE" DATE DEFAULT SYSDATE NOT NULL,
    CONSTRAINT "PK_BOARD" PRIMARY KEY ("BOARD_NO")
);

-- IMAGE 테이블 생성
CREATE TABLE "IMAGE" (
    "IMG_NO" NUMBER NOT NULL,
    "BOARD_NO" NUMBER NOT NULL,
    "IMG_PATH" VARCHAR2(150) NOT NULL,
    "IMG_NAME" VARCHAR2(300) NOT NULL,
    "IMG_RENAME" VARCHAR2(100) NOT NULL,
    "IMG_ACTIVE" CHAR(1) DEFAULT 'N' NOT NULL,
    "IMG_REF_NUM" NUMBER,
    "IMG_REF_TYPE" VARCHAR2(10) NOT NULL,
    "IMG_TITLE" NUMBER DEFAULT 0 NOT NULL,
    CONSTRAINT "PK_IMAGE" PRIMARY KEY ("IMG_NO")
);

-- REPLY 테이블 생성
CREATE TABLE "REPLY" (
    "RE_NO" NUMBER NOT NULL,
    "RE_WRITER_NO" NUMBER NOT NULL,
    "BOARD_NO" NUMBER NOT NULL,
    "RE_CONTENT" CLOB NOT NULL,
    "CREATE_DATE" DATE DEFAULT SYSDATE NOT NULL,
    "UPDATE_DATE" DATE DEFAULT SYSDATE NOT NULL,
    "RE_STATUS" CHAR(1) DEFAULT 'Y' NOT NULL,
    "REPLY_COUNT" NUMBER DEFAULT 0,
    CONSTRAINT "PK_REPLY" PRIMARY KEY ("RE_NO")
);

-- CATEGORY 테이블 생성
CREATE TABLE "CATEGORY" (
    "CATE_NO" NUMBER NOT NULL,
    "CATE_TITLE" VARCHAR2(15) NOT NULL,
    CONSTRAINT "PK_CATEGORY" PRIMARY KEY ("CATE_NO")
);

-- 시퀀스 생성
CREATE SEQUENCE USER_SEQ START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE BOARD_SEQ START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE IMAGE_SEQ START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE REPLY_SEQ START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE CATEGORY_SEQ START WITH 1 INCREMENT BY 1;

-- 테이블 코멘트
COMMENT ON TABLE "USER" IS '방문자 정보 테이블';
COMMENT ON TABLE "BOARD" IS '게시판 테이블';
COMMENT ON TABLE "IMAGE" IS '이미지 테이블';
COMMENT ON TABLE "REPLY" IS '댓글 테이블';
COMMENT ON TABLE "CATEGORY" IS '카테고리 테이블';

-- USER 테이블 컬럼 코멘트
COMMENT ON COLUMN "USER"."USER_NO" IS '사용자 번호';
COMMENT ON COLUMN "USER"."USER_NAME" IS '이름';
COMMENT ON COLUMN "USER"."USER_ID" IS '아이디';
COMMENT ON COLUMN "USER"."USER_PWD" IS '비밀번호';
COMMENT ON COLUMN "USER"."USER_EMAIL" IS '이메일';
COMMENT ON COLUMN "USER"."USER_PHONE" IS '전화번호';
COMMENT ON COLUMN "USER"."USER_STATUS" IS '활성화 여부';
COMMENT ON COLUMN "USER"."USER_GRADE" IS '블로거 여부';
COMMENT ON COLUMN "USER"."USER_JOIN_DATE" IS '가입일자';

-- BOARD 테이블 컬럼 코멘트
COMMENT ON COLUMN "BOARD"."BOARD_NO" IS '게시글 번호';
COMMENT ON COLUMN "BOARD"."CATE_NO" IS '카테고리 번호';
COMMENT ON COLUMN "BOARD"."BOARD_WRITER_NO" IS '사용자 번호';
COMMENT ON COLUMN "BOARD"."BOARD_WRITER_NAME" IS '작성자 이름';
COMMENT ON COLUMN "BOARD"."BOARD_TITLE" IS '제목';
COMMENT ON COLUMN "BOARD"."BOARD_CONTENT" IS '내용';
COMMENT ON COLUMN "BOARD"."BOARD_COUNT" IS '조회수';
COMMENT ON COLUMN "BOARD"."BOARD_STATUS" IS '삭제여부';
COMMENT ON COLUMN "BOARD"."CREATE_DATE" IS '작성일자';
COMMENT ON COLUMN "BOARD"."UPDATE_DATE" IS '수정일자';

-- IMAGE 테이블 컬럼 코멘트
COMMENT ON COLUMN "IMAGE"."IMG_NO" IS '이미지 번호';
COMMENT ON COLUMN "IMAGE"."BOARD_NO" IS '게시글 번호';
COMMENT ON COLUMN "IMAGE"."IMG_PATH" IS '이미지 경로';
COMMENT ON COLUMN "IMAGE"."IMG_NAME" IS '이미지 이름';
COMMENT ON COLUMN "IMAGE"."IMG_RENAME" IS '이미지 리네임';
COMMENT ON COLUMN "IMAGE"."IMG_ACTIVE" IS '이미지 삭제 여부';
COMMENT ON COLUMN "IMAGE"."IMG_REF_NUM" IS '이미지 구분 번호';
COMMENT ON COLUMN "IMAGE"."IMG_REF_TYPE" IS '이미지 구분 타입';
COMMENT ON COLUMN "IMAGE"."IMG_TITLE" IS '썸네일 여부 (1: 썸네일, 0: 일반 이미지)';

-- REPLY 테이블 컬럼 코멘트
COMMENT ON COLUMN "REPLY"."RE_NO" IS '댓글 번호';
COMMENT ON COLUMN "REPLY"."RE_WRITER_NO" IS '댓글 사용자 번호';
COMMENT ON COLUMN "REPLY"."BOARD_NO" IS '게시글 번호';
COMMENT ON COLUMN "REPLY"."RE_CONTENT" IS '내용';
COMMENT ON COLUMN "REPLY"."CREATE_DATE" IS '작성일';
COMMENT ON COLUMN "REPLY"."UPDATE_DATE" IS '수정일';
COMMENT ON COLUMN "REPLY"."RE_STATUS" IS '댓글 삭제여부';
COMMENT ON COLUMN "REPLY"."REPLY_COUNT" IS '댓글 수';

-- CATEGORY 테이블 컬럼 코멘트
COMMENT ON COLUMN "CATEGORY"."CATE_NO" IS '카테고리 번호';
COMMENT ON COLUMN "CATEGORY"."CATE_TITLE" IS '카테고리 제목';

-- 뷰 생성
CREATE OR REPLACE VIEW BOARD_VIEW AS
SELECT 
    B.BOARD_NO,
    B.CATE_NO,
    C.CATE_TITLE,
    B.BOARD_WRITER_NO,
    B.BOARD_WRITER_NAME,
    B.BOARD_TITLE,
    B.BOARD_CONTENT,
    B.BOARD_COUNT,
    B.BOARD_STATUS,
    B.CREATE_DATE,
    B.UPDATE_DATE,
    (SELECT COUNT(*) FROM "REPLY" R WHERE R.BOARD_NO = B.BOARD_NO) AS REPLY_COUNT
FROM 
    "BOARD" B
JOIN 
    "CATEGORY" C ON B.CATE_NO = C.CATE_NO;

-- 뷰에 대한 코멘트
COMMENT ON TABLE BOARD_VIEW IS '게시판 상세 정보 뷰';
COMMENT ON COLUMN BOARD_VIEW.BOARD_NO IS '게시글 번호';
COMMENT ON COLUMN BOARD_VIEW.CATE_NO IS '카테고리 번호';
COMMENT ON COLUMN BOARD_VIEW.CATE_TITLE IS '카테고리 제목';
COMMENT ON COLUMN BOARD_VIEW.BOARD_WRITER_NO IS '게시글 작성자 번호';
COMMENT ON COLUMN BOARD_VIEW.BOARD_WRITER_NAME IS '게시글 작성자 이름';
COMMENT ON COLUMN BOARD_VIEW.BOARD_TITLE IS '게시글 제목';
COMMENT ON COLUMN BOARD_VIEW.BOARD_CONTENT IS '게시글 내용';
COMMENT ON COLUMN BOARD_VIEW.BOARD_COUNT IS '게시글 조회수';
COMMENT ON COLUMN BOARD_VIEW.BOARD_STATUS IS '게시글 상태';
COMMENT ON COLUMN BOARD_VIEW.CREATE_DATE IS '게시글 작성일';
COMMENT ON COLUMN BOARD_VIEW.UPDATE_DATE IS '게시글 수정일';
COMMENT ON COLUMN BOARD_VIEW.REPLY_COUNT IS '댓글 수';